# üîß –†–£–ß–ù–û–ô –î–ï–ü–õ–û–ô - –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

## –®–ê–ì 1: –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É

–û—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à –æ–±—ã—á–Ω—ã–π —Ç–µ—Ä–º–∏–Ω–∞–ª (–≥–¥–µ –≤—ã —É–∂–µ –ø–æ–¥–∫–ª—é—á–∞–ª–∏—Å—å) –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```bash
ssh root@85.239.56.80
# –ü–∞—Ä–æ–ª—å: qk_sAs#7qBPE5j
```

---

## –®–ê–ì 2: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Docker –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

```bash
# –û–±–Ω–æ–≤–∏—Ç–µ —Å–∏—Å—Ç–µ–º—É
apt update && apt upgrade -y

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Docker
curl -fsSL https://get.docker.com -o get-docker.sh
sh get-docker.sh

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Docker Compose
apt install docker-compose-plugin -y

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∫—É
docker --version
docker compose version
```

---

## –®–ê–ì 3: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ firewall

```bash
# –†–∞–∑—Ä–µ—à–∏—Ç–µ –Ω—É–∂–Ω—ã–µ –ø–æ—Ä—Ç—ã
apt install ufw -y
ufw allow 22/tcp
ufw allow 80/tcp
ufw allow 443/tcp
ufw --force enable

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å
ufw status
```

---

## –®–ê–ì 4: –°–æ–∑–¥–∞–π—Ç–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞

```bash
mkdir -p /var/www/asset-manager
cd /var/www/asset-manager
```

---

## –®–ê–ì 5: –ó–∞–≥—Ä—É–∑–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä

### –í–∞—Ä–∏–∞–Ω—Ç –ê: –ß–µ—Ä–µ–∑ Git (–µ—Å–ª–∏ –µ—Å—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π)

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
apt install git -y
git clone <–≤–∞—à-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π-url> /var/www/asset-manager
cd /var/www/asset-manager
```

### –í–∞—Ä–∏–∞–Ω—Ç –ë: –ß–µ—Ä–µ–∑ WinSCP –∏–ª–∏ FileZilla

1. –°–∫–∞—á–∞–π—Ç–µ **WinSCP**: https://winscp.net/eng/download.php
2. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å:
   - Host: `85.239.56.80`
   - User: `root`
   - Password: `qk_sAs#7qBPE5j`
   - Port: `22`
3. –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –≤—Å—é –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞ –≤ `/var/www/asset-manager`

### –í–∞—Ä–∏–∞–Ω—Ç –í: –ß–µ—Ä–µ–∑ –∞—Ä—Ö–∏–≤

**–ù–∞ –≤–∞—à–µ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ** (–≤ PowerShell –≤ –ø–∞–ø–∫–µ –ø—Ä–æ–µ–∫—Ç–∞):

```powershell
# –°–æ–∑–¥–∞–π—Ç–µ –∞—Ä—Ö–∏–≤ –±–µ–∑ –ª–∏—à–Ω–∏—Ö —Ñ–∞–π–ª–æ–≤
tar -czf deploy.tar.gz --exclude='node_modules' --exclude='.next' --exclude='__pycache__' --exclude='*.pyc' --exclude='.git' --exclude='postgres_data' --exclude='private.ppk' --exclude='certbot' .
```

–ó–∞—Ç–µ–º –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ WinSCP –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞ `deploy.tar.gz` –Ω–∞ —Å–µ—Ä–≤–µ—Ä –≤ `/tmp/`

**–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ**:

```bash
cd /var/www/asset-manager
tar -xzf /tmp/deploy.tar.gz
rm /tmp/deploy.tar.gz
```

---

## –®–ê–ì 6: –°–æ–∑–¥–∞–π—Ç–µ .env.production –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

**–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ** –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```bash
cd /var/www/asset-manager

cat > .env.production << 'EOF'
# Django Settings
DEBUG=False
SECRET_KEY=Y{1!Y\&s8W>YqhgU9N^~SBC->Q&2/<UzxGb2vdd+2g!6X:3aRk
ALLOWED_HOSTS=raskadrawka.ru,www.raskadrawka.ru,85.239.56.80,localhost,backend

# Database
POSTGRES_DB=apom_production
POSTGRES_USER=apom_user
POSTGRES_PASSWORD=rc8Q>FPR$k
DB_HOST=db
DB_PORT=5432

# Redis
REDIS_HOST=redis
CELERY_BROKER_URL=redis://redis:6379/0
CELERY_RESULT_BACKEND=redis://redis:6379/0

# AWS S3 (Timeweb)
AWS_ACCESS_KEY_ID=9IK65D3WEVBF7OP7GS42
AWS_SECRET_ACCESS_KEY=N4r1GOADgA4He7NV2wcRt6bYb02cdsAVxS2IJqhy
AWS_STORAGE_BUCKET_NAME=ai-production-asset-managemer
AWS_S3_REGION_NAME=ru-1
AWS_S3_ENDPOINT_URL=https://s3.timeweb.com

# Frontend
NEXT_PUBLIC_API_URL=https://raskadrawka.ru
EOF
```

---

## –®–ê–ì 7: –ü–æ–¥–≥–æ—Ç–æ–≤—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

```bash
cd /var/www/asset-manager

# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ production –∫–æ–Ω—Ñ–∏–≥ –¥–ª—è Next.js
cp next.config.production.mjs frontend/next.config.mjs

# –°–æ–∑–¥–∞–π—Ç–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è Nginx –∏ SSL
mkdir -p nginx/conf.d
mkdir -p certbot/conf
mkdir -p certbot/www
```

---

## –®–ê–ì 8: –ó–∞–ø—É—Å—Ç–∏—Ç–µ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã

```bash
cd /var/www/asset-manager

# –°–æ–±–µ—Ä–∏—Ç–µ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker compose -f docker-compose.production.yml up -d --build
```

–≠—Ç–æ –∑–∞–π–º–µ—Ç 5-10 –º–∏–Ω—É—Ç. –ñ–¥–∏—Ç–µ –ø–æ–∫–∞ —Å–æ–±–µ—Ä—É—Ç—Å—è –æ–±—Ä–∞–∑—ã.

---

## –®–ê–ì 9: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∑–∞–ø—É—Å—Ç–∏–ª–∏—Å—å

```bash
# –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —Å–ø–∏—Å–æ–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker ps

# –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω—ã:
# - apom_db (PostgreSQL)
# - apom_redis (Redis)
# - apom_backend (Django)
# - apom_celery (Celery)
# - apom_frontend (Next.js)
# - apom_nginx (Nginx)
```

---

## –®–ê–ì 10: –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
# –ü–æ–¥–æ–∂–¥–∏—Ç–µ 10 —Å–µ–∫—É–Ω–¥ —á—Ç–æ–±—ã –ë–î –∑–∞–ø—É—Å—Ç–∏–ª–∞—Å—å
sleep 10

# –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏
docker compose -f docker-compose.production.yml exec backend python manage.py migrate

# –°–æ–±–µ—Ä–∏—Ç–µ —Å—Ç–∞—Ç–∏–∫—É
docker compose -f docker-compose.production.yml exec backend python manage.py collectstatic --noinput
```

---

## –®–ê–ì 11: –°–æ–∑–¥–∞–π—Ç–µ —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```bash
docker compose -f docker-compose.production.yml exec backend python manage.py createsuperuser
```

–í–≤–µ–¥–∏—Ç–µ:
- Username: `admin` (–∏–ª–∏ –ª—é–±–æ–π –¥—Ä—É–≥–æ–π)
- Email: `admin@raskadrawka.ru`
- Password: (–ø—Ä–∏–¥—É–º–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å)

---

## –®–ê–ì 12: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É

–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: **http://raskadrawka.ru**

–¢–∞–∫–∂–µ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
- –ê–¥–º–∏–Ω–∫–∞: http://raskadrawka.ru/admin
- API: http://raskadrawka.ru/api

---

## –®–ê–ì 13 (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –ù–∞—Å—Ç—Ä–æ–π—Ç–µ HTTPS

```bash
cd /var/www/asset-manager

# –ü–æ–ª—É—á–∏—Ç–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
docker compose -f docker-compose.production.yml run --rm certbot certonly \
  --webroot \
  --webroot-path=/var/www/certbot \
  -d raskadrawka.ru \
  -d www.raskadrawka.ru \
  --email your-email@example.com \
  --agree-tos \
  --no-eff-email

# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ nginx –∫–æ–Ω—Ñ–∏–≥
nano nginx/conf.d/default.conf

# –ù–∞–π–¥–∏—Ç–µ —Å—Ç—Ä–æ–∫—É "# return 301 https://" –∏ —É–¥–∞–ª–∏—Ç–µ "#"
# –ù–∞–π–¥–∏—Ç–µ –±–ª–æ–∫ "# server {" —Å –ø–æ—Ä—Ç–æ–º 443 –∏ —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –≤–µ—Å—å –±–ª–æ–∫
# –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ: Ctrl+O, Enter, Ctrl+X

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ nginx
docker compose -f docker-compose.production.yml restart nginx
```

–¢–µ–ø–µ—Ä—å —Å–∞–π—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ HTTPS: https://raskadrawka.ru

---

## üîÑ –û–ë–ù–û–í–õ–ï–ù–ò–ï –ø—Ä–æ–µ–∫—Ç–∞

–ö–æ–≥–¥–∞ –≤–Ω–µ—Å–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏ –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:

```bash
# 1. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã —á–µ—Ä–µ–∑ WinSCP –∏–ª–∏:
cd /var/www/asset-manager
# (–∑–∞–≥—Ä—É–∑–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ª—é–±—ã–º —Å–ø–æ—Å–æ–±–æ–º)

# 2. –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker compose -f docker-compose.production.yml down
docker compose -f docker-compose.production.yml up -d --build

# 3. –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å)
docker compose -f docker-compose.production.yml exec backend python manage.py migrate
```

---

## üìä –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
```bash
cd /var/www/asset-manager

# –í—Å–µ –ª–æ–≥–∏
docker compose -f docker-compose.production.yml logs -f

# –õ–æ–≥–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
docker compose -f docker-compose.production.yml logs -f backend
docker compose -f docker-compose.production.yml logs -f frontend
docker compose -f docker-compose.production.yml logs -f nginx
```

### –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã
```bash
cd /var/www/asset-manager

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å—ë
docker compose -f docker-compose.production.yml restart

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Å–µ—Ä–≤–∏—Å
docker compose -f docker-compose.production.yml restart backend
```

### –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å/–ó–∞–ø—É—Å—Ç–∏—Ç—å
```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
docker compose -f docker-compose.production.yml down

# –ó–∞–ø—É—Å—Ç–∏—Ç—å
docker compose -f docker-compose.production.yml up -d
```

### –ó–∞–π—Ç–∏ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
```bash
# Backend shell
docker compose -f docker-compose.production.yml exec backend bash

# PostgreSQL
docker compose -f docker-compose.production.yml exec db psql -U apom_user -d apom_production
```

---

## ‚ùå –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –Ω–µ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è
```bash
# –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏
docker compose -f docker-compose.production.yml logs

# –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ —Å –Ω—É–ª—è
docker compose -f docker-compose.production.yml down -v
docker compose -f docker-compose.production.yml up -d --build
```

### –°–∞–π—Ç –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ nginx
docker compose -f docker-compose.production.yml logs nginx

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –ø–æ—Ä—Ç—ã –æ—Ç–∫—Ä—ã—Ç—ã
netstat -tulpn | grep LISTEN

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ firewall
ufw status
```

### –û—à–∏–±–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –ë–î –∑–∞–ø—É—â–µ–Ω–∞
docker compose -f docker-compose.production.yml exec db pg_isready

# –ü–µ—Ä–µ—Å–æ–∑–¥–∞–π—Ç–µ –ë–î (–í–ù–ò–ú–ê–ù–ò–ï: —É–¥–∞–ª–∏—Ç –¥–∞–Ω–Ω—ã–µ!)
docker compose -f docker-compose.production.yml down -v
docker compose -f docker-compose.production.yml up -d
docker compose -f docker-compose.production.yml exec backend python manage.py migrate
```

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç

- [ ] Docker —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- [ ] Firewall –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] –ü—Ä–æ–µ–∫—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –≤ `/var/www/asset-manager`
- [ ] –§–∞–π–ª `.env.production` —Å–æ–∑–¥–∞–Ω
- [ ] –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∑–∞–ø—É—â–µ–Ω—ã (`docker ps`)
- [ ] –ú–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã
- [ ] –°—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω
- [ ] –°–∞–π—Ç –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è: http://raskadrawka.ru
- [ ] –ê–¥–º–∏–Ω–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç: http://raskadrawka.ru/admin
- [ ] HTTPS –Ω–∞—Å—Ç—Ä–æ–µ–Ω (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

---

**–í—Å—ë!** –≠—Ç–æ –≤–µ—Å—å –ø—Ä–æ—Ü–µ—Å—Å. –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç - —Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏:

```bash
docker compose -f docker-compose.production.yml logs -f
```
