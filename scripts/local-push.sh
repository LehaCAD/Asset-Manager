#!/bin/bash
# –°–∫—Ä–∏–ø—Ç –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä
# –ó–∞–ø—É—Å–∫–∞—Ç—å –Ω–∞ –õ–û–ö–ê–õ–¨–ù–û–ú –∫–æ–º–ø—å—é—Ç–µ—Ä–µ

set -e

echo "üîÑ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–∫–æ–º–º–∏—á–µ–Ω—ã
if [[ -n $(git status -s) ]]; then
    echo "‚ö†Ô∏è  –£ –≤–∞—Å –µ—Å—Ç—å –Ω–µ–∑–∞–∫–æ–º–º–∏—á–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:"
    git status -s
    echo ""
    read -p "–•–æ—Ç–∏—Ç–µ —Å–æ–∑–¥–∞—Ç—å –∫–æ–º–º–∏—Ç? (y/n) " -n 1 -r
    echo
    if [[ $REPLY =~ ^[Yy]$ ]]; then
        read -p "–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–æ–º–º–∏—Ç–∞: " COMMIT_MSG
        git add .
        git commit -m "$COMMIT_MSG"
    else
        echo "‚ùå –û—Ç–º–µ–Ω–∞. –°–Ω–∞—á–∞–ª–∞ –∑–∞–∫–æ–º–º–∏—Ç—å—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è."
        exit 1
    fi
fi

# –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
echo "üì§ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ Git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π..."
git push origin main

# –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É –∏ –¥–µ–ø–ª–æ–∏–º
echo "üöÄ –î–µ–ø–ª–æ–∏–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä..."
ssh root@85.239.56.80 "cd /opt/asset-manager && ./scripts/deploy.sh"

echo "‚úÖ –ì–æ—Ç–æ–≤–æ! –ò–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ."
