# Assets App

Django-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞—Å—Å–µ—Ç–∞–º–∏ (–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ –∏ –≤–∏–¥–µ–æ) –≤ AI Asset Manager.

## –ú–æ–¥–µ–ª–∏

### Asset
- `box` (FK) - –±–æ–∫—Å, –∫ –∫–æ—Ç–æ—Ä–æ–º—É –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∞—Å—Å–µ—Ç
- `asset_type` (CharField) - —Ç–∏–ø –∞—Å—Å–µ—Ç–∞: IMAGE –∏–ª–∏ VIDEO
- `file_url` (URLField) - URL —Ñ–∞–π–ª–∞ –Ω–∞ S3 –∏–ª–∏ –¥—Ä—É–≥–æ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
- `thumbnail_url` (URLField) - URL –ø—Ä–µ–≤—å—é –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
- `is_favorite` (BooleanField) - —Ñ–ª–∞–≥ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
- `prompt_text` (TextField) - —Ç–µ–∫—Å—Ç –ø—Ä–æ–º–ø—Ç–∞ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- `ai_model` (FK) - AI –º–æ–¥–µ–ª—å, —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–≤—à–∞—è –∞—Å—Å–µ—Ç (nullable)
- `generation_config` (JSONField) - –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (width, height, steps, –∏ —Ç.–¥.)
- `seed` (IntegerField) - seed –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (nullable)
- `created_at` - –¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è
- `updated_at` - –¥–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

**–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:** –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∞—Å—Å–µ—Ç—ã —Å–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –ø–æ –¥–∞—Ç–µ —Å–æ–∑–¥–∞–Ω–∏—è (–Ω–æ–≤—ã–µ –ø–µ—Ä–≤—ã–º–∏).

**–¢–∏–ø—ã –∞—Å—Å–µ—Ç–æ–≤:**
- `IMAGE` - –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
- `VIDEO` - –í–∏–¥–µ–æ

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞
```
assets/
‚îú‚îÄ‚îÄ migrations/          # –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
‚îú‚îÄ‚îÄ admin.py            # –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ –∞–¥–º–∏–Ω–∫–µ
‚îú‚îÄ‚îÄ apps.py             # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ models.py           # –ú–æ–¥–µ–ª—å Asset
‚îú‚îÄ‚îÄ serializers.py      # DRF —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä—ã
‚îú‚îÄ‚îÄ views.py            # DRF ViewSets
‚îú‚îÄ‚îÄ urls.py             # URL —Ä–æ—É—Ç–∏–Ω–≥ –¥–ª—è API
‚îú‚îÄ‚îÄ services.py         # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îú‚îÄ‚îÄ tests.py            # 13 unit —Ç–µ—Å—Ç–æ–≤
‚îú‚îÄ‚îÄ test_api.py         # 14 API —Ç–µ—Å—Ç–æ–≤
‚îú‚îÄ‚îÄ API_DOCS.md         # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è REST API
‚îî‚îÄ‚îÄ README.md           # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ

–ú–æ–¥–µ–ª—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∞ –≤ Django Admin —Å:
- **list_display**: id, box, asset_type, is_favorite, created_at
- **list_filter**: asset_type, is_favorite, box__project (—Ñ–∏–ª—å—Ç—Ä —á–µ—Ä–µ–∑ FK!)
- **search_fields**: prompt_text
- **list_editable**: is_favorite - –º–æ–∂–Ω–æ –æ—Ç–º–µ—á–∞—Ç—å –∏–∑–±—Ä–∞–Ω–Ω–æ–µ –ø—Ä—è–º–æ –∏–∑ —Å–ø–∏—Å–∫–∞!
- –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–æ–π –ø–æ–ª–µ–π –≤ fieldsets (–æ—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, —Ñ–∞–π–ª—ã, –ø—Ä–æ–º–ø—Ç)

### –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∞–¥–º–∏–Ω–∫–∏
- üåü –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ is_favorite –ø—Ä—è–º–æ –∏–∑ —Å–ø–∏—Å–∫–∞ (list_editable)
- üîç –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ç–∏–ø—É, –∏–∑–±—Ä–∞–Ω–Ω–æ–º—É –∏ –ø—Ä–æ–µ–∫—Ç—É (—á–µ—Ä–µ–∑ box__project)
- üîé –ü–æ–∏—Å–∫ –ø–æ —Ç–µ–∫—Å—Ç—É –ø—Ä–æ–º–ø—Ç–∞
- üìä –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—Å–µ—Ö –∫–ª—é—á–µ–≤—ã—Ö –ø–æ–ª–µ–π –≤–∫–ª—é—á–∞—è ID

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```python
from apps.assets.services import (
    create_asset,
    update_asset,
    toggle_favorite,
    delete_asset,
    get_box_assets,
    get_favorite_assets
)
from apps.assets.models import Asset

# –°–æ–∑–¥–∞–Ω–∏–µ –∞—Å—Å–µ—Ç–∞-–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
asset = create_asset(
    box=my_box,
    asset_type=Asset.ASSET_TYPE_IMAGE,
    file_url='https://s3.example.com/image.jpg',
    thumbnail_url='https://s3.example.com/thumb.jpg',
    prompt_text='A beautiful sunset over mountains'
)

# –°–æ–∑–¥–∞–Ω–∏–µ –∞—Å—Å–µ—Ç–∞-–≤–∏–¥–µ–æ
video = create_asset(
    box=my_box,
    asset_type=Asset.ASSET_TYPE_VIDEO,
    file_url='https://s3.example.com/video.mp4'
)

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ
asset = update_asset(asset, is_favorite=True)

# –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
toggle_favorite(asset)

# –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –∞—Å—Å–µ—Ç–æ–≤ –±–æ–∫—Å–∞
assets = get_box_assets(my_box)

# –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
images = get_box_assets(my_box, asset_type=Asset.ASSET_TYPE_IMAGE)

# –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö
favorites = get_favorite_assets(my_box)

# –£–¥–∞–ª–µ–Ω–∏–µ
delete_asset(asset)
```

## –°–≤—è–∑–∏

```
User ‚Üí Project ‚Üí Box ‚Üí Asset
                       ‚îî‚îÄassets (related_name)
```

- **Box ‚Üí Asset**: –æ–¥–∏–Ω –∫–æ –º–Ω–æ–≥–∏–º (related_name='assets')
- –ë–æ–∫—Å –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–æ –∞—Å—Å–µ—Ç–æ–≤
- –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –±–æ–∫—Å–∞ –≤—Å–µ –µ–≥–æ –∞—Å—Å–µ—Ç—ã —É–¥–∞–ª—è—é—Ç—Å—è (CASCADE)

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å AI –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º–∏

–ú–æ–¥–µ–ª—å –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ —Å AI –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º–∏:
- **ai_model** (FK –Ω–∞ AIModel) - —Å–≤—è–∑—å —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –º–æ–¥–µ–ª—å—é AI
- **generation_config** (JSONField) - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- **seed** (IntegerField) - seed –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç–∏

–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç:
- –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å, –∫–∞–∫–∞—è –º–æ–¥–µ–ª—å —Å–æ–∑–¥–∞–ª–∞ –∫–∞–∂–¥—ã–π –∞—Å—Å–µ—Ç
- –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é —Å —Ç–µ–º–∏ –∂–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
- –û—Ç–æ–±—Ä–∞–∂–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤ UI

–ì–æ—Ç–æ–≤–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å:
- **Kie.ai Nano Banana** - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (asset_type=IMAGE)
- **Kie.ai Seedance** - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–∏–¥–µ–æ (asset_type=VIDEO)

–ü–æ–ª—è –¥–ª—è –±—É–¥—É—â–µ–≥–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è (—Å–æ–≥–ª–∞—Å–Ω–æ TECHNICAL.md):
- [ ] `source_type` - GENERATED | UPLOADED | IMG2VID
- [ ] `parent_asset_id` - –¥–ª—è —Å–≤—è–∑–∏ –≤–∏–¥–µ–æ —Å –∏—Å—Ö–æ–¥–Ω—ã–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º
- [ ] `status` - PENDING | PROCESSING | COMPLETED | FAILED
- [ ] `error_message` - —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
- [ ] `retry_count` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫ –ø–æ–≤—Ç–æ—Ä–∞

## –¢–µ—Å—Ç—ã

### Unit —Ç–µ—Å—Ç—ã (tests.py)
13 unit-—Ç–µ—Å—Ç–æ–≤ –ø–æ–∫—Ä—ã–≤–∞—é—Ç:
- –°–æ–∑–¥–∞–Ω–∏–µ –∞—Å—Å–µ—Ç–æ–≤ —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ (IMAGE, VIDEO)
- –°—Ç—Ä–æ–∫–æ–≤–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Å get_asset_type_display()
- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫—É –ø–æ –¥–∞—Ç–µ —Å–æ–∑–¥–∞–Ω–∏—è (–Ω–æ–≤—ã–µ –ø–µ—Ä–≤—ã–º–∏)
- –û–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å —á–µ—Ä–µ–∑ related_name
- –í—Å–µ CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–∏—Å—ã
- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ (toggle_favorite)
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—é –ø–æ —Ç–∏–ø—É –∞—Å—Å–µ—Ç–∞
- –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö –∞—Å—Å–µ—Ç–æ–≤

### API —Ç–µ—Å—Ç—ã (test_api.py)
14 API-—Ç–µ—Å—Ç–æ–≤ –ø–æ–∫—Ä—ã–≤–∞—é—Ç:
- ‚úÖ –°–ø–∏—Å–æ–∫ –∞—Å—Å–µ—Ç–æ–≤ (—Ç–æ–ª—å–∫–æ —Å–≤–æ–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤)
- ‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ box
- ‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ asset_type (IMAGE/VIDEO)
- ‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ is_favorite (true/false)
- ‚úÖ –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –∞—Å—Å–µ—Ç–∞
- ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–µ—Ç–∞–ª–µ–π
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ (PUT/PATCH)
- ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ permissions (IsBoxProjectOwner)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ box_name –∏ ai_model_name

**–í—Å–µ–≥–æ: 27 —Ç–µ—Å—Ç–æ–≤ –¥–ª—è Assets**

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### 1. Choices –¥–ª—è —Ç–∏–ø–æ–≤
–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∫–ª–∞—Å—Å–∞ –¥–ª—è —Ç–∏–ø–æ–≤:
```python
Asset.ASSET_TYPE_IMAGE  # 'IMAGE'
Asset.ASSET_TYPE_VIDEO  # 'VIDEO'
```

–ú–µ—Ç–æ–¥ `get_asset_type_display()` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —á–∏—Ç–∞–µ–º–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ.

### 2. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
–°–µ—Ä–≤–∏—Å—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç `select_related('box', 'box__project')` –¥–ª—è –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î.

### 3. –ì–∏–±–∫–æ—Å—Ç—å URL –ø–æ–ª–µ–π
URLField —Å max_length=500 –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö S3 URL —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –∏ –ø–æ–¥–ø–∏—Å—è–º–∏.

### 4. –ü–æ–∏—Å–∫ –ø–æ –ø—Ä–æ–º–ø—Ç—É
`search_fields = ('prompt_text',)` –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏—Å–∫–∞—Ç—å –∞—Å—Å–µ—Ç—ã –ø–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É –ø—Ä–æ–º–ø—Ç–∞ –≤ –∞–¥–º–∏–Ω–∫–µ.

## REST API

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤–∫–ª—é—á–∞–µ—Ç –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π REST API –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∞—Å—Å–µ—Ç–∞–º–∏.

### –û—Å–Ω–æ–≤–Ω—ã–µ endpoints
- `GET /api/assets/` - —Å–ø–∏—Å–æ–∫ –∞—Å—Å–µ—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `GET /api/assets/?box=123` - –∞—Å—Å–µ—Ç—ã –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –±–æ–∫—Å–∞
- `GET /api/assets/?asset_type=IMAGE` - —Ñ–∏–ª—å—Ç—Ä –ø–æ —Ç–∏–ø—É
- `GET /api/assets/?is_favorite=true` - —Ç–æ–ª—å–∫–æ –∏–∑–±—Ä–∞–Ω–Ω—ã–µ
- `POST /api/assets/` - —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∞—Å—Å–µ—Ç
- `GET /api/assets/{id}/` - –ø–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏ –∞—Å—Å–µ—Ç–∞
- `PATCH /api/assets/{id}/` - —á–∞—Å—Ç–∏—á–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –∞—Å—Å–µ—Ç
- `DELETE /api/assets/{id}/` - —É–¥–∞–ª–∏—Ç—å –∞—Å—Å–µ—Ç

### –°–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä
AssetSerializer –≤–∫–ª—é—á–∞–µ—Ç –≤—Å–µ –ø–æ–ª—è + –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ:
- `box_name` (SerializerMethodField) - –Ω–∞–∑–≤–∞–Ω–∏–µ –±–æ–∫—Å–∞
- `ai_model_name` (SerializerMethodField) - –Ω–∞–∑–≤–∞–Ω–∏–µ AI –º–æ–¥–µ–ª–∏

### Permissions
- **IsAuthenticated** - —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- **IsBoxProjectOwner** - –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –∫ –∞—Å—Å–µ—Ç–∞–º –±–æ–∫—Å–æ–≤ —Å–≤–æ–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤

### –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è
–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ:
1. `box` - –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –±–æ–∫—Å
2. `asset_type` - IMAGE –∏–ª–∏ VIDEO
3. `is_favorite` - true –∏–ª–∏ false

–§–∏–ª—å—Ç—Ä—ã –º–æ–∂–Ω–æ –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞—Ç—å:
```
/api/assets/?box=123&asset_type=IMAGE&is_favorite=true
```

–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: **[API_DOCS.md](API_DOCS.md)**
